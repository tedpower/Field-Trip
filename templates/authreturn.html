{% extends "_base.html" %}
{% block bodycontent %}

{% if user.updated %}
    <div id="photos" class="clearfix">
        {% for trip in user.get_all_trips %}
                {% if trip.home and trip.photos %}
                    <h2>Home in {{user.fs_homeCity}}</h2>
                    <div class="trip clearfix">

                    {% for photo in trip.get_all_photos %}
                      {% if not photo.hidden %}
                        <div id="{{photo.key_id}}" class="photo home" style="background-image:url({{ photo.fs_300 }})"></div>
                      {% endif %}
                    {% endfor %}
                {% else %}
                    {% if not trip.home and trip.photos %}
                        <h2>{{ trip.title }}
                        <div class="date">
                            {% ifequal trip.start_date|date:"M j, Y" trip.end_date|date:"M j, Y" %}
                                {{ trip.start_date|date:"M j, Y" }}
                            {% else %}
                                {{ trip.start_date|date:"M j, Y" }} - {{ trip.end_date|date:"M j, Y" }}
                            {% endifequal %}
                        </div>
                        </h2>
                        <div class="trip clearfix">

                        {% for photo in trip.get_all_photos %}
                          {% if not photo.hidden %}
                            <div id="{{photo.key_id}}" class="photo home" style="background-image:url({{ photo.fs_300 }})"></div>
                          {% endif %}
                        {% endfor %}
                    {% endif %}
                {% endif %}
            </div>
        {% endfor %}
    </div>

    <div id="hide" class="invisible"></div>

    {% for trip in user.get_all_trips %}
        {% for photo in trip.get_all_photos %}
            <div id="l{{photo.key_id}}"  class="lightbox hidden">
                <div class="zoomContent" style="width:{{ photo.width }}px;">
                    <img src="{{ photo.photo_url }}">
                    <div class="meta" style="width:{{ photo.width }}px;">
                        {% if photo.shout %}
                            <div class="shout"><span class="firstname">{{ user.fs_firstName }}:</span> "{{photo.shout}}"</div>
                        {% endif %}
                        {% if photo.fs_venue_name and photo.fs_venue_id %}
                          <a class="venue" href="https://foursquare.com/v/{{photo.fs_venue_id}}">{{photo.fs_venue_name}}</a>
                        {% else %}
                          {% if photo.fs_venue_name%}
                            <div class="venue">{{photo.fs_venue_name}}</div>
                          {% endif %}
                        {% endif %}
                        {% if photo.link %}
                          <a class="date" href="{{ photo.link }}">{{ photo.fs_createdAt|date:"M j, Y" }}</a>
                        {% else %}
                          <div class="date">{{ photo.fs_createdAt|date:"M j, Y" }}</div>
                        {% endif %}
                        <a href="/hidePhoto?id={{ photo.key_id }}">Hide</a>
                    </div>
                </div>
            </div>
        {% endfor %}
    {% endfor %}

    <div id="end"></div>

{% else %}
    <div id="photos" class="clearfix"></div>

    <script>
    function updatePhotos() {
      $.ajax({
        url: "/preview?startAt=0",
        cache: false,
        success: function(html){
          $("#photos").append(html);
        }
       });
       // $.ajax({
       //   url: "/updateAll",
       //   cache: false,
       //   success: function(html){
       //     $("#photos").prepend(html);
       //   }
       //  });
     }
    updatePhotos();
    </script>
{% endif %}

<!-- <script>
{% if user.updated %}
    var test = true;
{% else %}
    var test = false;
{% endif %}

function updatePage() {
    location.reload(true);
}
if (test == false) {
    setTimeout('updatePage()', 4000);
}
</script> -->


<div style="padding: 30px"><a href="/ig_auth">Sign in with instagram</a>
| <a href="/fs_auth">Sign in with foursquare</a>
| <a href="/merge">merge instagram and 4sq</a>
| <a href="/findTrips">Find Trips</a></div>

{% endblock %}
